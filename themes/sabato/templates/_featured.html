<section id="posts" class="pb-0">
    <div class="container">
        <div class="section-title h2 text-center mb-8">
            <h2 class="mb-0">Featured Posts</h2>
            <span class="title-letter">P</span>
        </div>
        <div class="row">
            {# 1. Filter the featured articles into a list first #}
            {% set featured_articles = [] %}
            {% for article in articles %}
                {% if article.tags and 'featured' in article.tags|map(attribute='name') %}
                    {% set _ = featured_articles.append(article) %}
                {% endif %}
            {% endfor %}

            {# 2. Loop through only the first 6 articles #}
            {% for article in featured_articles[:6] %}
                {% set article_path_no_domain = article.url|replace('https://chrissabato.com/', '') %}
                {% set article_path = article_path_no_domain|replace('/index.html', '') %}

                {# 3. Use loop.index to add 'd-none d-sm-flex' to items 4, 5, and 6 #}
                <div class="col-md-6 col-lg-4 mb-6 {% if loop.index > 3 %}d-none d-sm-flex{% else %}d-flex{% endif %}">
                    <article class="feature-block feature-boxed feature-decorated h-100 d-flex flex-column w-100" style="position: relative;">                           
                        <a href="{{article_path}}" class="full-block-link" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 5;">
                            <span class="sr-only">Read more about {{ article.title }}</span>
                        </a>

                        <div class="mb-4">
                            {% if article.image is defined %}
                                <img class="img-fluid w-100 rounded"  src="{{ article_path }}/{{ article.image }}" alt="{{ article.title }}">
                            {% else %}
                                <img class="img-fluid w-100 rounded" src="{{ article_path }}/{{ article_path }}.jpg" alt="{{ article.title }}">
                            {% endif %}
                        </div>

                        <small class="d-block mb-1"> {{ article.locale_date }}</small>
                        <h2 class="h4 mb-1">
                            {{ article.title }}
                        </h2>
    
                        <p class="mb-0">{{ article.summary }}</p>
                    </article>
                </div>
            {% endfor %}

        </div>
        <div class="text-center">
            <a href="/archives.html" class="btn btn-primary btn-sm">View More Posts</a>
        </div>
    </div>
</section>